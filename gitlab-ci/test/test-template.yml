test_general:
  stage: test
  image:
    name: sctests/chrome-grid-mvn
  tags:
    - Runner_Tag
  script:
    - su seluser
    - /opt/bin/entry_point.sh &
    - mvn -Dmaven.repo.local=.m2/repository clean test
    - mkdir -p target/site/allure-maven-plugin/history
    - mkdir target/allure-results/history
    - cp -n -f -r /allurehistory/history/* target/allure-results/history/
    - mvn -Dmaven.repo.local=.m2/repository allure:report
    - find /allurehistory/history/ -type f -exec rm {} \;
    - cp -n -f -r target/site/allure-maven-plugin/history/* /allurehistory/history/
    - foldername=$(date +%Y-%m-%d' '%H:%M:%S)
    - mkdir -p /allure-reports/report/"$foldername"
    - cp -n -f -r target/site/allure-maven-plugin/* /allure-reports/report/"$foldername"/
    - echo -e "{\"pipelineUrl\":\""$CI_PIPELINE_URL"\",\"pipelineId\":\""$CI_PIPELINE_ID"\",\"project\":\""UI_Autotests_MFC_Next"\",\"date\":\""$foldername"\"}" > /allure-reports/report/"$foldername"/info.json
  only:
    - never
  artifacts:
    paths:
      - target/allure-results/
      - target/site/allure-maven-plugin/
